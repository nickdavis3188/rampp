<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../www/css/responsive.css">
    <link rel="stylesheet" href="../www/css/bootstrap.min.css">
    <link rel="stylesheet" href="../www/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="../www/css/style1.css">
    <link rel="shortcut icon" href="../www/images/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="../www/css/s1.css">
    <link rel="shortcut icon" href="../www/css/dataTable.css" />
    <link rel="stylesheet" href="../www/css/fontawesome.min.css">
    <link rel="stylesheet" href="../www/css/jquery.dataTables.min.css">
    <title>purchaseRequisition</title>
</head>
<body>

    <br>
    <br>
    <div class="container">
        <!-- body -->
        <div class="table-responsive pt-3">
          <table class="table table-bordered">
            <tbody>
                                  
              <!-- head -->
              <tr>
                <td rowspan="2" colspan="2">
                  <div class="row">
                    <!-- <div class="col-md-6">
                                                                                                                                                                  <img src="../../Upload/logo.jpeg" style="width:200px">
                                                                                                                                                                </div> -->
                    <div class="col-12">
                      <h5 style="color:#02679a;font-size:25px">Purchase Requisition</h5>
                    <div>
                  </div>
                </td>                      
                <td colspan="3">
                  <div class="row">
                    
                    <div class="col-12"><span style="color:#02679a"> PR-NO: </span> &nbsp;&nbsp;&nbsp; <span class="reqno"> </span></div>
                    <!-- <div class="col-9"></div> -->
                  </div>                                
                </td>                        
              </tr>
              <tr>                    
                <td colspan="3">
                  <div class="row">
                    <div class="col-12"><span style="color:#02679a"> DATE: </span>&nbsp;&nbsp;<span class="dprep"></span></div>
                    <!-- <div class="col-9"></div> -->
                  </div>                                        
                </td>
              </tr>
              <!--End head -->
              <tr>
                <td colspan="3">
                  <div class="row">
                    <div class="col-2"><span style="color:#02679a"> For: </span>&nbsp;&nbsp;<span class="frrr"></span></div>
                    <!-- <div class="col-10"><p class="frrr"></p></div> -->
                  </div>                                      
                </td>
                <td colspan="2">
                  <div class="row">
                    <div class="col-6"><span style="color:#02679a"> REQUISITIONER: </span>&nbsp;&nbsp;<span class="reqner"></span></div>
                    <!-- <div class="col-6"><p class="reqner"></p></div> -->
                  </div>  
                </td>
              </tr>
              <tr>
                  <td colspan="5">
                    <div class="row">
                      <div class="col-2"><span style="color:#02679a"> SUMMARY: </span>&nbsp;&nbsp;<span class="summ"></span></div>
                      <!-- <div class="col-10"><p class="summ"></p></div> -->
                    </div>  
                  </td>
                  <!-- <td colspan="3">
                    <span style="color:#02679a">For: </span><span >Restock</span>
                  </td> -->
              </tr>
            
            </tbody>
          </table>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th width="5%">
                  SN
                </th>
                <th width="25%">
                  Item Name
                </th>
                <th width="35%">
                  Desc
                </th>
                <th width="5%">
                  Qty
                </th>
                <th width="15%">
                  Unit Price
                </th>
                <th width="15%">
                  SubTotal
                </th>
              </tr>
            </thead>
            <tbody id="tbb">                                   
            </tbody>
            <tr>
              <td colspan="4">
                
              </td>
              <td class="text-right">
                <span style="color:#02679a"> GRAND TOTAL </span>
              </td>
              <td>
                <div class="row">
                    <div class="col-12"> <b>
                        <p class="tot"> </p>
                      </b></div>
                </div>                                 
              </td>
              
            </tr>
          </table>
        </div>
        <br>
        <br>
        <hr>
        <div class="row">
          <div class="col-4">
            <div class="sups text-center" style="line-height: 9px;font-size: x-small;">
                <p class="text-info">Pending</p>

            </div>
            
              
        </div>
        <div class="col-4">
            <div class="mns text-center" style="line-height: 9px;font-size: x-small;">
                <p class="text-info">Pending</p>
            </div>
            
          
        </div>
        <div class="col-4">
          <div class="mnds text-center" style="line-height: 9px;font-size: x-small;">
                <p class="text-info">Pending</p>
            </div>
            
        
        </div>
        </div>
        <hr>
        </div>
        <br>
        <br>
        <br>
        <br>


    <script src="../www/js/jQuery1.9.1.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="../www/js/bootstrap.min.js"></script>
 
    <!-- plugins JS
		============================================ -->

    <script src="../www/js/plugins.js"></script>
     <!-- Data Table JS
		============================================ -->
    <script src="../www/js/jquery.dataTables.min.js"></script>
    <script src="../www/js/data-table-act.js"></script>


  <!-- plugins:js -->
  <script src="../www/vendors/base/vendor.bundle.base.js" ></script>
 
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <!-- <script src="../../www/vendors/chart.js/Chart.min.js"></script> -->
  <script src="../www/js/jquery.cookie.js" type="text/javascript"></script>
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script src="../www/js/off-canvas.js"></script>
  <script src="../www/js/hoverable-collapse.js"></script>
  <script src="../www/js/template.js"></script>
  
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="../www/js/dashboard.js"></script>

  <script>

       let par = new URLSearchParams(window.location.search)
       let id = par.get("pRegNo")

       let reqno = document.querySelector(".reqno"); 
       let subj = document.querySelector(".frrr"); 
       let from = document.querySelector(".reqner"); 
       let dateprep = document.querySelector(".dprep"); 
       let summ = document.querySelector(".summ");  
       let tbodyy = document.querySelector("#tbb"); 
       let total = document.querySelector(".tot");
       let manStatus = document.querySelector(".mns"); 
       let manDStatus = document.querySelector(".mnds"); 
       let supStatus = document.querySelector(".sups"); 
     
       const dateFormat = (date)=>{
          var today = new Date(date);
          var dd = String(today.getDate()).padStart(2, '0');
          var mm = String(today.getMonth() + 1).padStart(2, '0'); 
          var yyyy = today.getFullYear();

          today = mm + '/' + dd + '/' + yyyy;
          return today
        }
   
       let mydata = JSON.stringify({ "pRegNo": id})
       fetch("../Utils/getSinglePurchaseRegUtils.php", {
       method: 'POST',
       body: mydata,
       headers: {"Content-Type": "application/json; charset=utf-8"}
       }).then(res=>res.json()).then(function(data) {
            console.log(data)
            reqno.innerText = data[0].preqno
           dateprep.innerText = dateFormat(data[0].dateprepared)
           subj.innerText = data[0].subject
           from.innerText = data[0].from
           summ.innerText = data[0].summary
           total.innerText = "# "+Number(data[0].total).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')
   
         if (data[1].length < 1) {
           let list1 = document.createElement("tr");
           let hypertest = `      
               <td colspan="6" class="test-center">NO DATA AVILABLE</td>                   
           `;
           list1.innerHTML = hypertest
           tbodyy.appendChild(list1)
         } else {
           
           let child = tbodyy.lastElementChild; 
           while (child) {
             tbodyy.removeChild(child);
               child = tbodyy.lastElementChild;
           }
           data[1].forEach((element,ind) => {
   
                 let list2 = document.createElement("tr");
                 list2.innerHTML = `       
                     <td>${ind+1}</td>
                     <td>${element.itemname}</td>
                     <td>${element.description}</td>
                     <td>${element.qty}</td>   
                     <td># ${ Number(element.unitprice).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')}</td>                      
                     <td># ${Number(element.subtotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')}</td>                    
                 `;
                 tbodyy.appendChild(list2);
                 
             }) 
         }
   
     
    
      
         let manstat = () => {
        let child = manStatus.lastElementChild; 
        while (child) {
          manStatus.removeChild(child);
            child = manStatus.lastElementChild;
        }
        if (data[0].manapprove == "Pending") {
          manStatus.innerHTML = `<p class="text-warning">Pending</p><br/><p class="text-warning">Manager</p><br/><p class="text-warning">${data[0].manremark}</p><br/><p class="text-warning">${dateFormat(data[0].mandate)}</p>` 
        } else if(data[0].manapprove == "decline") {
          manStatus.innerHTML = `<p class="text-danger">Decline</p><br/><p class="text-danger">Manager</p><br/><p style="color:#02679a">${data[0].manremark}</p><br/><p class="text-danger">${dateFormat(data[0].mandate)}</p>`         
        }else{
          if (data[0].mansig) {
            manStatus.innerHTML = `<img src="${data[0].mansig}" width="100px"/><br/><p class="text-success">Manager</p><br/><p class="text-success">${data[0].manremark}</p><br/><p class="text-success">${dateFormat(data[0].mandate)}</p>` 
            
          } else {
            manStatus.innerHTML = `<p class="text-success">Approve</p><br/><br/><p class="text-success">Manager</p><p class="text-success">${data[0].manremark}</p><br/><p class="text-success">${dateFormat(data[0].mandate)}</p>`
          }
        }
      }
      let mandstat = ()=>{
        let child = manDStatus.lastElementChild; 
        while (child) {
          manDStatus.removeChild(child);
            child = manDStatus.lastElementChild;
        }
        if (data[0].mandapprove == "Pending") {
          manDStatus.innerHTML = `<p class="text-warning">Pending</p><br/><p class="text-warning">Managing Director</p><br/><p class="text-warning">${data[0].mandremark}</p><br/><p class="text-warning">${dateFormat(data[0].manddate)}</p>` 
        } else if(data[0].mandapprove == "decline") {
          manDStatus.innerHTML = `<p class="text-danger">Decline</p><br/><p class="text-danger">Managing Director</p><br/><p style="color:#02679a">${data[0].mandremark}</p><br/><p class="text-danger">${dateFormat(data[0].manddate)}</p>`         
        }else{
          if (data[0].mandsig) {
            manDStatus.innerHTML = `<img src="${data[0].mandsig}" width="100px"/><br/><p class="text-success">Managing Director</p><br/><p class="text-success">${data[0].mandremark}</p><br/><p class="text-success">${dateFormat(data[0].manddate)}</p>` 
          } else {
            manDStatus.innerHTML = `<p class="text-success">Approve</p><br/><p class="text-success">Managing Director</p><br/><p class="text-success">${data[0].mandremark}</p><br/><p class="text-success">${dateFormat(data[0].manddate)}</p>`   
          }
        }
      }

      let supstat = ()=>{
        let child = supStatus.lastElementChild; 
        while (child) {
          supStatus.removeChild(child);
            child = supStatus.lastElementChild;
        }
        if (data[0].supapprove == "Pending") {
          supStatus.innerHTML = `<p class="text-warning">Pending</p><br/><p class="text-warning">Supervisor</p><br/><p class="text-warning">${data[0].supremark}</p><br/><p class="text-warning">${dateFormat(data[0].supdate)}</p>` 
        } else if(data[0].supapprove == "decline") {
          supStatus.innerHTML = `<p class="text-danger">Decline</p><br/><p class="text-danger">Supervisor</p><br/><p style="color:#02679a">${data[0].supremark}</p><br/><p class="text-danger">${dateFormat(data[0].supdate)}</p>`         
        }else{
          if (data[0].supsig) {
            supStatus.innerHTML = `<img src="${data[0].supsig}" width="100px"/><br/><p class="text-success">Supervisor</p><br/><p class="text-success">${data[0].supremark}</p><br/><p class="text-success">${dateFormat(data[0].supdate)}</p>`          
          } else {
            supStatus.innerHTML = `<p class="text-success">Approve</p><br/><p class="text-success">Supervisor</p><br/><p class="text-success">${data[0].supremark}</p><br/><p class="text-success">${dateFormat(data[0].supdate)}</p>` 
          }
        }
      }

         manstat()
         mandstat()
         supstat()

   
         window.print()
    }).catch(err=>{
         if (err) {
           alert("Error:"+err)
           console.log("error",err)
        
         }
       })
     
   
   
   
   </script>
</body>
</html>